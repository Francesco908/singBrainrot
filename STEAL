-- Auto Farm script per BrainRot (LocalScript)
-- Posiziona questo script in StarterGui come LocalScript

-- SERVICES
local Players      = game:GetService("Players")
local RunService   = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- PLAYER E CHARACTER
local player = Players.LocalPlayer
if not player then
    warn("Player non trovato! Assicurati che sia un LocalScript in StarterGui.")
    return
end

-- Variabili di gioco
local root, humanoid
local autoFarmEnabled = false
local farmConnection

-- Funzione di setup del Character
local function onCharacterAdded(character)
    local hrp = character:WaitForChild("HumanoidRootPart", 10)
    local hmd = character:WaitForChild("Humanoid", 10)
    if hrp and hmd then
        root = hrp
        humanoid = hmd
        print("[AutoFarm] Character caricato correttamente.")
    else
        warn("[AutoFarm] Impossibile ottenere HumanoidRootPart o Humanoid.")
    end
end

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then
    onCharacterAdded(player.Character)
end

-- GUI CREATION
local playerGui = player:WaitForChild("PlayerGui", 10)
if not playerGui then
    warn("PlayerGui non trovato!")
    return
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoFarmGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local function createButton(name, text, pos, parent)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = UDim2.new(1, -20, 0, 20)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 12
    btn.Text = text
    btn.BorderSizePixel = 0
    btn.Parent = parent
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 4)
    corner.Parent = btn
    return btn
end

local frame = Instance.new("Frame")
frame.Name = "AutoFarmFrame"
frame.Size = UDim2.new(0, 200, 0, 120)
frame.Position = UDim2.new(0.05, 0, 0.5, -60)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 8)
frameCorner.Parent = frame

-- Toggle AutoFarm
local toggleBtn = createButton("ToggleButton", "Auto Farm: OFF", UDim2.new(0, 10, 0, 10), frame)
-- Fast Buy / Fast Open Buttons
o local buyBtn = createButton("FastBuyButton", "Fast Buy", UDim2.new(0, 10, 0, 40), frame)
local openBtn = createButton("FastOpenButton", "Fast Open", UDim2.new(0, 10, 0, 70), frame)

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseButton"
closeBtn.Size = UDim2.new(0, 20, 0, 20)
closeBtn.Position = UDim2.new(1, -25, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 12
closeBtn.Text = "X"
closeBtn.BorderSizePixel = 0
closeBtn.Parent = frame
local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 4)
closeCorner.Parent = closeBtn

-- FUNZIONI UTILI
local function getNearestItems()
    if not root then return {} end
    local items = {}
    local maxDistance = 1000
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name:match("^Item%d*$")) then
            local dist = (root.Position - obj.Position).Magnitude
            if dist <= maxDistance then
                table.insert(items, {part = obj, distance = dist})
            end
        end
    end
    table.sort(items, function(a, b) return a.distance < b.distance end)
    local result = {}
    for _, entry in ipairs(items) do
        table.insert(result, entry.part)
    end
    return result
end

local function teleportToItem(item)
    if not root or not item or not item.Parent then return end
    local success, err = pcall(function()
        root.CFrame = CFrame.new(item.Position + Vector3.new(0, 5, 0))
    end)
    if not success then warn("[AutoFarm] Errore teletrasporto:", err) end
end

local function startAutoFarm()
    if farmConnection then return end
    print("[AutoFarm] Avvio auto farm...")
    farmConnection = RunService.Heartbeat:Connect(function()
        if autoFarmEnabled and root then
            local items = getNearestItems()
            for _, itm in ipairs(items) do
                teleportToItem(itm)
                task.wait(0.1)
            end
        end
    end)
end

local function stopAutoFarm()
    if farmConnection then
        farmConnection:Disconnect()
        farmConnection = nil
        print("[AutoFarm] Auto farm fermato.")
    end
end

-- Eventi GUI
toggleBtn.MouseButton1Click:Connect(function()
    autoFarmEnabled = not autoFarmEnabled
    if autoFarmEnabled then
        toggleBtn.Text = "Auto Farm: ON"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        startAutoFarm()
    else
        toggleBtn.Text = "Auto Farm: OFF"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        stopAutoFarm()
    end
end)

buyBtn.MouseButton1Click:Connect(function()
    for _, prompt in ipairs(workspace:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") then
            if prompt.ActionText:lower():find("buy") then
                prompt.HoldDuration = 0
            end
        end
    end
    print("[AutoFarm] Fast Buy abilitato.")
end)

openBtn.MouseButton1Click:Connect(function()
    for _, prompt in ipairs(workspace:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") then
            if prompt.ActionText:lower():find("open") then
                prompt.HoldDuration = 0
            end
        end
    end
    print("[AutoFarm] Fast Open abilitato.")
end)

closeBtn.MouseButton1Click:Connect(function()
    stopAutoFarm()
    screenGui:Destroy()
    print("[AutoFarm] GUI chiusa.")
end)

Players.PlayerRemoving:Connect(function(leavingPlayer)
    if leavingPlayer == player then stopAutoFarm() end
end)

print("[AutoFarm] GUI inizializzata con Fast Buy e Fast Open.")
